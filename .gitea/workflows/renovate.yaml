---
  # yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
  name: "Renovate"
  
  on:
    # workflow_dispatch:
    #   inputs:
    #     dryRun:
    #       description: Dry Run
    #       default: "false"
    #       required: false
    #     logLevel:
    #       description: Log Level
    #       default: debug
    #       required: false
    #     version:
    #       description: Renovate version
    #       default: latest
    #       required: false
    schedule:
      - cron: "*/5 * * * *" # Every hour
    push:
      branches: ["main"]
      # paths:
      #   - .gitea/renovate/renovate.json5
      #   - .gitea/renovate/**.json5
  
  concurrency:
    group: ${{ gitea.workflow }}-${{ gitea.event.number || gitea.ref }}
    cancel-in-progress: true
  
  jobs:
    renovate:
      name: Renovate
      runs-on: ubuntu-latest
      container: ghcr.io/renovatebot/renovate:38.88.2
      steps:
        - uses: actions/checkout@v4
        - run: renovate
          env:
            RENOVATE_ENDPOINT: "https://git.noms.tv"
            RENOVATE_AUTODISCOVER: true
            RENOVATE_AUTODISCOVER_FILTER: "${{ gitea.repository }}"
            RENOVATE_DRY_RUN: "${{ inputs.dryRun == true }}"
            RENOVATE_PLATFORM: gitea
            RENOVATE_PLATFORM_COMMIT: true
            WORKFLOW_RENOVATE_VERSION: "${{ inputs.version || 'latest' }}"
            RENOVATE_CONFIG_FILE: "/workspace/Homelab/Home-Ops/.gitea/renovate/renovate.json5"
            LOG_LEVEL: "${{ inputs.logLevel || 'debug' }}"
            RENOVATE_TOKEN: "${{ secrets.RENOVATE_TOKEN }}"