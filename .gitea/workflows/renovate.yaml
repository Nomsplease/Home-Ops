---
  # yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
  name: "Renovate"
  
  on:
    # workflow_dispatch:
    #   inputs:
    #     dryRun:
    #       description: Dry Run
    #       default: "false"
    #       required: false
    #     logLevel:
    #       description: Log Level
    #       default: debug
    #       required: false
    #     version:
    #       description: Renovate version
    #       default: latest
    #       required: false
    schedule:
      - cron: "*/5 * * * *" # Every hour
    push:
      branches: ["main"]
      # paths:
      #   - .gitea/renovate/renovate.json5
      #   - .gitea/renovate/**.json5
  
  concurrency:
    group: ${{ gitea.workflow }}-${{ gitea.event.number || gitea.ref }}
    cancel-in-progress: true
  
  env:
    LOG_LEVEL: "${{ inputs.logLevel || 'debug' }}"
    DOCKER_HOST: "tcp://docker:2376"
    DOCKER_TLS_VERIFY: "1"
    DOCKER_CERT_PATH: /certs/client
    RENOVATE_DOCKER_CLI_OPTIONS: "-H tcp://docker:2376"
    RENOVATE_AUTODISCOVER: true
    RENOVATE_AUTODISCOVER_FILTER: "${{ gitea.repository }}"
    RENOVATE_DRY_RUN: "${{ inputs.dryRun == true }}"
    RENOVATE_PLATFORM: gitea
    RENOVATE_PLATFORM_COMMIT: true
    WORKFLOW_RENOVATE_VERSION: "${{ inputs.version || 'latest' }}"
  
  jobs:
    renovate:
      name: Renovate
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            token: "${{ secrets.RENOVATE_TOKEN }}"
  
        - name: Renovate
          uses: renovatebot/github-action@v40.2.5
          with:
            configurationFile: .gitea/renovate/renovate.json5
            token: "${{ secrets.RENOVATE_TOKEN }}"
            renovate-version: "${{ env.WORKFLOW_RENOVATE_VERSION }}"