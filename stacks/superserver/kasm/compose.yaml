---
services:
  kasm:
    image: lscr.io/linuxserver/kasm:1.16.1-ls73
    container_name: kasm
    privileged: true
    security_opt:
      - apparmor:rootlesskit #optional
    environment:
      - KASM_PORT=443
      - NVIDIA_VISIBLE_DEVICES=all
    networks:
      - default
      - traefik_proxy
    volumes:
      - /data/containers/kasm/app:/opt
      - /data/containers/kasm/profiles:/profiles
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.kasm.entrypoints=websecure
      - traefik.http.routers.kasm.rule=Host(`workspaces.noms.tv`)
      - traefik.http.services.kasm.loadbalancer.server.port=443
      - traefik.http.services.kasm.loadbalancer.server.scheme=https
      - traefik.http.routers.kasm.service=kasm
      - traefik.http.routers.kasm.tls=true
networks:
  default:
    name: kasm_network
  traefik_proxy:
    name: traefik_proxy
    external: true